<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/assets/icons/ajunet.ico" type="image/x-icon">
    <title>EmpreGo | Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            500: '#8B5CF6',
                            600: '#7C3AED',
                        },
                        dark: {
                            900: '#000000',
                            800: '#0A0A0A',
                            700: '#141414',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="/css/chat.css">

    <style>
        #docIcon {
            width: 30px;
            height: 30px;
            position: relative;
            right: 6px;
        }
    </style>

</head>

<body class="bg-dark-900 text-white h-screen flex overflow-hidden">
    <!-- <div id="modalDelete" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div id="modalDelete-content" class="bg-dark-800 rounded-xl p-6 w-full max-w-md">
            <h3 class="text-lg font-semibold mb-4 text-center"><strong>Você tem certeza de que quer deletar a tag?</strong></h3>
            <div class="flex justify-center space-x-3">
                <button id="btnCancelarDel" class="px-4 py-2 rounded-lg bg-dark-600 text-gray-300 hover:bg-dark-500 transition-colors">Cancelar</button>
                <button id="btnConfirmarDel" class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors">Confirmar</button>
            </div>
        </div>
    </div> -->
    <div id="loader-container"></div>
    <script>
        fetch("/components/loader/loader.html")
            .then(res => res.text())
            .then(html => {
                document.getElementById("loader-container").innerHTML = html;

                // Só carrega o JS do loader depois que o HTML foi injetado
                const script = document.createElement("script");
                script.src = "/components/loader/loader.js";
                document.body.appendChild(script);
            });
    </script>
    <!-- Sidebar -->
    <aside class="w-16 bg-dark-800 border-r border-gray-800 flex flex-col h-full items-center py-4">
        <!-- Foto de perfil do usuário -->
        <a href="/perfil/candidato" class="relative mb-8">
            <img src="/assets/imgs/genPfp.png" alt="Foto de perfil do usuário" id="FotoDePerfil"
                class="w-8 h-8 object-cover rounded-full cursor-pointer" />
            <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-dark-800"
                id="bolaSemMexer"></div>
        </a>

        <!-- Ícones de navegação -->
        <nav class="flex-1 flex flex-col space-y-8 items-center">
            <a href="/" class="sidebar-icon text-gray-400 hover:text-white transition-colors">
                <i class="fa-solid fa-house"></i>
            </a>
            <a href="#" class="sidebar-icon text-gray-400 hover:text-white transition-colors">
                <i class="fa-solid fa-users text-xl"></i>
            </a>
            <a href="#" class="sidebar-icon text-gray-400 hover:text-white transition-colors">
                <i class="fa-solid fa-bell text-xl"></i>
                <span class="notification-badge">3</span>
            </a>
            <a href="/perfil/candidato" class="sidebar-icon text-gray-400 hover:text-white transition-colors">
                <i class="fa-solid fa-star"></i>
            </a>
        </nav>

        <!-- Configurações e voltar -->
        <div class="mt-auto flex flex-col space-y-6 items-center">
            <a href="#" class="sidebar-icon text-gray-400 hover:text-white transition-colors">
                <i class="fa-solid fa-gear text-xl"></i>
            </a>
            <a href="#" class="sidebar-icon text-gray-400 hover:text-white transition-colors"
                onclick="history.back(); return false;">
                <i class="fa-solid fa-reply"></i>
            </a>
        </div>
    </aside>

    <!-- conversas (1 pra N) -->
    <aside class="w-80 bg-dark-800 border-r border-gray-800 flex flex-col h-full">
        <div class="p-4 border-b border-gray-800">
            <h2 class="text-lg font-semibold">Conversas</h2>
        </div>

        <!-- Lista das conversas -->
        <div class="flex-1 overflow-y-auto custom-scrollbar" id="conversations-list">
            <!-- As conversas serão inseridas aqui via JavaScript (O código todo está lá) -->
        </div>

    </aside>

    <!-- início do chat principal (1 pra 1)-->
    <main class="flex-1 flex flex-col h-full bg-dark-900 relative">
        <!-- Tela de boas-vindas -->
        <div id="TelaBoasVindas"
            class="absolute inset-0 flex flex-col items-center justify-center text-center bg-dark-900 z-10">


            <h1 class="text-3xl font-bold text-primary-500 mb-4">Bem-vindo ao Chat</h1>
            <p class="text-lg text-gray-400 mb-8 max-w-xl">
                Conecte-se facilmente com empresas e candidatos em um só lugar.
                Nosso chat foi desenvolvido para facilitar o processo de contratação,
                garantindo uma comunicação rápida, clara e segura.
            </p>

            <div class="download-card bg-dark-800 rounded-xl p-6 mb-8 text-left w-96 shadow-md">
                <h2 class="text-xl font-semibold text-white mb-4 justify-center text-center items-center">
                    <i class="fa-solid fa-briefcase mr-3 text-primary-500"></i>
                    Como funciona
                </h2>
                <p class="text-gray-400 mb-4">
                    <span id="conversaText">• Converse diretamente com empresas ou candidatos.</span> <br>
                    • Organize oportunidades e contatos em um só espaço. <br>
                    • Todas as mensagens são protegidas com criptografia.
                </p>

            </div>

            <p class="text-sm text-gray-500">
                <i class="fa-solid fa-lock mr-1"></i>
                Suas conversas no EmpreGo são privadas e seguras.
            </p>

        </div>

        <!-- estrutura do header da conversa (1 pra 1)-->
        <header class="bg-dark-800 px-6 py-4 border-b border-gray-800 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div
                    class="w-10 h-10 rounded-full bg-primary-500 flex items-center justify-center text-white font-semibold">
                    <img src="/assets/imgs/genPfp.png" id="current-chat-avatar"
                        class="w-full h-full object-cover rounded-full">
                </div>
                <div>
                    <h2 class="font-semibold" id="current-chat-name">Name</h2>
                    <p class="text-sm text-gray-400 flex items-center">
                        <span class="w-2 h-2 rounded-full bg-red-500 mr-2" id="bolaStatus"></span>
                        <span id="current-chat-status">Offline</span>
                    </p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button id="search-toggle" class="p-2 rounded-full w-12 h-12 hover:bg-gray-700 transition-colors"
                    aria-label="Pesquisar conversa">
                    <i class="fa-solid fa-search"></i>
                </button>

                <div class="relative">
                    <button id="menu-toggle" class="p-2 rounded-full hover:bg-gray-700 w-12 h-12 transition-colors"
                        aria-label="Menu">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </button>

                    <!-- Dropdown Menu -->
                    <div id="menu-dropdown"
                        class="hidden absolute right-0 mt-2 w-64 bg-dark-800 shadow-lg rounded-lg overflow-hidden border border-gray-700 z-50">
                        <ul class="py-2 text-sm text-gray-200">
                            <li class="px-4 py-2 hover:bg-gray-700 cursor-pointer flex items-center space-x-2">
                                <i class="fa-solid fa-circle-info text-gray-400"></i>
                                <span>Dados do contato</span>
                            </li>
                            <li class="px-4 py-2 hover:bg-gray-700 cursor-pointer flex items-center space-x-2">
                                <i class="fa-solid fa-heart text-gray-400"></i>
                                <span>Adicionar aos favoritos</span>
                            </li>
                            <li id="fecharBtn"
                                class="px-4 py-2 hover:bg-gray-700 cursor-pointer flex items-center space-x-2">
                                <i class="fa-solid fa-xmark text-gray-400"></i>
                                <span>Fechar conversa</span>
                            </li>

                            <hr class="border-gray-700 my-2">

                            <li id="bloquearBtn"
                                class="px-4 py-2 hover:bg-gray-700 cursor-pointer flex items-center space-x-2">
                                <i class="fa-solid fa-ban text-gray-400"></i>
                                <span id="bloquearTxt">Bloquear</span>
                            </li>
                            <li id="limparBtn"
                                class="px-4 py-2 hover:bg-gray-700 cursor-pointer flex items-center space-x-2">
                                <i class="fa-solid fa-trash text-gray-400"></i>
                                <span id="limparTxt">Limpar conversa</span>
                            </li>
                            <li id="apagarBtn"
                                class="px-4 py-2 hover:bg-gray-700 cursor-pointer flex items-center space-x-2">
                                <i class="fa-solid fa-trash-can text-gray-400"></i>
                                <span id="apagarTxt">Apagar conversa</span>
                            </li>
                        </ul>
                    </div>
                </div>

            </div>
        </header>

        <!-- Barra de pesquisa (inicialmente oculta, (melhorar o estilo!!!!)) -->
        <div id="search-bar" class="bg-dark-800 p-3 border-b border-gray-800 hidden">
            <div class="flex items-center">
                <input type="text" id="search-input" placeholder="Pesquisar nesta conversa..."
                    class="flex-1 bg-dark-700 text-white rounded-lg px-4 py-2 outline-none">
                <button id="search-prev" class="ml-2 p-2 rounded-full hover:bg-gray-700 transition-colors"
                    aria-label="Resultado anterior">
                    <i class="fa-solid fa-chevron-up"></i>
                </button>
                <button id="search-next" class="ml-2 p-2 rounded-full hover:bg-gray-700 transition-colors"
                    aria-label="Próximo resultado">
                    <i class="fa-solid fa-chevron-down"></i>
                </button>
                <button id="search-close" class="ml-2 p-2 rounded-full hover:bg-gray-700 transition-colors"
                    aria-label="Fechar pesquisa">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Área das mensagens -->
        <div class="flex-1 overflow-y-auto p-6 custom-scrollbar bg-dark-900 bg-opacity-50" id="messages-container">
            <!-- As mensagens serão inseridas aqui via JavaScript -->
        </div>

        <!-- Menu de anexos -->
        <div id="attachment-menu"
            class="hidden absolute bottom-24 left-4 bg-[#1e1e1e] rounded-xl p-2 w-56 z-50 shadow-lg">
            <ul class="space-y-2">
                <li id="btn-documento" class="flex items-center gap-3 p-2 rounded-lg hover:bg-[#2a2a2a] cursor-pointer">
                    <i class="fa-solid fa-file text-purple-400 text-xl"></i>
                    <span class="text-gray-200">Documento</span>
                </li>
                <li id="btn-fotos" class="flex items-center gap-3 p-2 rounded-lg hover:bg-[#2a2a2a] cursor-pointer">
                    <i class="fa-solid fa-image text-blue-400 text-xl"></i>
                    <span class="text-gray-200">Fotos</span>
                </li>
                <li id="btn-camera" class="flex items-center gap-3 p-2 rounded-lg hover:bg-[#2a2a2a] cursor-pointer">
                    <i class="fa-solid fa-camera text-pink-500 text-xl"></i>
                    <span class="text-gray-200">Câmera</span>
                </li>
            </ul>
        </div>

        <input type="file" id="input-documento" class="hidden" accept=".pdf,.doc,.docx,.txt,.zip" />
        <input type="file" id="input-fotos" class="hidden" accept=".jpg,.jpeg,.png,.webp" />
        <input type="file" id="input-camera" accept="image/*" capture="environment" class="hidden">

        <!-- Mensagem de documento (antes do download) -->
        <div class="mensagem-arquivo bg-dark-800 rounded-xl p-3 flex items-center justify-between w-80 shadow-md my-2">
            <div class="flex items-center gap-3">
                <img src="/assets/imgs/DOCXICONROXO.jpeg" alt="" id="docIcon" class=" object-cover rounded-lg">
                
                <div>
                    <p class="text-white font-semibold text-sm truncate">bola azul.zip</p>
                    <p class="text-gray-400 text-xs">ZIP • 330 KB</p>
                </div>
            </div>
            <button class="download-btn text-gray-300 hover:text-white">
                <i class="fa-solid fa-download text-lg"></i>
            </button>
        </div>

        <div class="mensagem-arquivo bg-dark-800 rounded-xl p-3 flex items-center justify-between w-80 shadow-md my-2">
            <div class="flex items-center gap-3">
                <img src="/assets/imgs/PDF.jpeg" alt="" id="docIcon" class=" object-cover rounded-lg">
                <div>
                    <p class="text-white font-semibold text-sm truncate">bola azul 2.zip</p>
                    <p class="text-gray-400 text-xs">ZIP • 330 KB</p>
                </div>
            </div>
            <button class="download-btn text-gray-300 hover:text-white">
                <i class="fa-solid fa-download text-lg"></i>
            </button>
        </div>

        <div class="mensagem-arquivo bg-dark-800 rounded-xl p-3 flex items-center justify-between w-80 shadow-md my-2">
            <div class="flex items-center gap-3">
                <img src="/assets/imgs/TXTAZUL.jpeg" alt="" id="docIcon" class=" object-cover rounded-lg">
                <div>
                    <p class="text-white font-semibold text-sm truncate">bola azul 2.zip</p>
                    <p class="text-gray-400 text-xs">ZIP • 330 KB</p>
                </div>
            </div>
            <button class="download-btn text-gray-300 hover:text-white">
                <i class="fa-solid fa-download text-lg"></i>
            </button>
        </div>

        <div class="mensagem-arquivo bg-dark-800 rounded-xl p-3 flex items-center justify-between w-80 shadow-md my-2">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-file-zipper text-yellow-400 text-3xl"></i>
                <div>
                    <p class="text-white font-semibold text-sm truncate">bola azul 3.zip</p>
                    <p class="text-gray-400 text-xs">ZIP • 330 KB</p>
                </div>
            </div>
            <button class="download-btn text-gray-300 hover:text-white">
                <i class="fa-solid fa-download text-lg"></i>
            </button>
        </div>

        <!-- Depois do download -->
        <!-- <div class="mensagem-arquivo bg-dark-800 rounded-xl p-3 flex flex-col w-80 shadow-md my-2">
            <p class="text-white font-semibold text-sm truncate mb-2">bola azul.zip</p>
            <p class="text-gray-400 text-xs mb-3">Pasta compactada • 338 KB</p>
            <div class="flex gap-2">
                <button class="flex-1 bg-dark-700 hover:bg-gray-700 text-white text-sm py-2 rounded-lg">Abrir</button>
                <button class="flex-1 bg-dark-700 hover:bg-gray-700 text-white text-sm py-2 rounded-lg">Salvar
                    como...</button>
            </div>
        </div> -->

        <!-- Imagem enviada -->
        <div class="mensagem-imagem bg-dark-800 rounded-xl p-2 w-64 shadow-md my-2">
            <img src="https://via.placeholder.com/250x150.png" alt="Imagem enviada"
                class="rounded-lg w-full h-auto object-cover mb-2">
            <div class="flex justify-between text-xs text-gray-400">
                <span>Foto • 1.2 MB</span>
                <button class="text-primary-500 hover:underline">Baixar</button>
            </div>
        </div>

        <!-- Modal de confirmação -->
        <div id="modalConfirmacao"
            class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
            <div class="bg-dark-800 rounded-xl p-6 w-full max-w-md">
                <h3 class="text-lg font-semibold mb-4 text-center"><strong>Enviar arquivo?</strong></h3>
                <div class="bg-dark-700 rounded-xl p-3 mb-4 flex items-center">
                    <span id="modal-file-name" class="text-white font-semibold"></span>
                    <span id="modal-file-size" class="text-gray-400 ml-2"></span>
                </div>
                <div class="flex justify-center space-x-3">
                    <button id="btnCancelarEnvio"
                        class="px-4 py-2 rounded-lg bg-dark-600 text-gray-300 hover:bg-dark-500 transition-colors">Cancelar</button>
                    <button id="btnConfirmarEnvio"
                        class="px-4 py-2 rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition-colors">Confirmar</button>
                </div>
            </div>
        </div>


        <div class="bg-dark-800 p-4 border-t border-gray-800">
            <div class="flex items-end space-x-3">
                <button id="attach-button" class="p-2 rounded-full w-12 h-12 hover:bg-gray-700 transition-colors mb-2"
                    aria-label="Anexar arquivo">
                    <i class="fa-solid fa-paperclip text-gray-400"></i>
                </button>


                <div class="flex-1 bg-dark-700 rounded-2xl px-4 py-2 focus-within:ring-2 focus-within:ring-primary-500">
                    <textarea id="message-input"
                        class="w-full bg-transparent border-0 outline-none text-white message-input py-2"
                        placeholder="Digite sua mensagem..." rows="1" maxlength="500"></textarea>
                </div>

                <button id="send-button"
                    class="bg-primary-500 text-white p-3 w-12 h-12 rounded-full hover:bg-primary-600 transition-colors mb-2"
                    aria-label="Enviar mensagem">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>

            <div class="flex justify-between items-center mt-2 text-xs text-gray-500 px-2">
                <span>Pressione Enter para enviar</span>
                <span id="message-counter">0 mensagens nesta conversa</span>
            </div>
        </div>
    </main>
    <script>
        // Variáveis para controle do carregamento
        let loadingTime = 1000; // Tempo base de carregamento
        let progress = 0;

        // Variáveis para a animação 3D
        let scene, camera, renderer, sphere;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let sphereRotation = { x: 0, y: 0 };

        // Função para inicializar o loader
        function initLoader() {
            // Configuração do Particles.js para o loader
            if (typeof particlesJS !== 'undefined') {
                particlesJS('particles-js', {
                    particles: {
                        number: { value: 80, density: { enable: true, value_area: 800 } },
                        color: { value: "#8B5CF6" },
                        shape: { type: "circle" },
                        opacity: { value: 0.5, random: true },
                        size: { value: 3, random: true },
                        line_linked: {
                            enable: true,
                            distance: 150,
                            color: "#7C3AED",
                            opacity: 0.4,
                            width: 1
                        },
                        move: {
                            enable: true,
                            speed: 2,
                            direction: "none",
                            random: true,
                            straight: false,
                            out_mode: "out",
                            bounce: false
                        }
                    },
                    interactivity: {
                        detect_on: "canvas",
                        events: {
                            onhover: { enable: true, mode: "repulse" },
                            onclick: { enable: true, mode: "push" },
                            resize: true
                        }
                    },
                    retina_detect: true
                });
            }

            // Inicializar a animação 3D
            init3DSphere();

            // Animação da esfera central com GSAP
            if (typeof gsap !== 'undefined') {
                gsap.to('.orb', {
                    duration: 2,
                    scale: 1.1,
                    repeat: -1,
                    yoyo: true,
                    ease: "power1.inOut"
                });

                // Animação dos anéis com GSAP
                gsap.to('.ring-1', {
                    duration: 3,
                    scale: 1.2,
                    opacity: 0,
                    repeat: -1,
                    ease: "power1.out"
                });
            }

            // Animação dos hexágonos com Anime.js
            if (typeof anime !== 'undefined') {
                anime({
                    targets: '.hexagon',
                    rotate: '360',
                    duration: 18000,
                    easing: 'linear',
                    loop: true
                });

                // Animação dos elementos flutuantes
                anime({
                    targets: '.absolute.rounded-full:not(#bolaSemMexer)',
                    translateY: () => anime.random(-20, 20),
                    translateX: () => anime.random(-15, 15),
                    duration: () => anime.random(2000, 5000),
                    easing: 'easeInOutQuad',
                    direction: 'alternate',
                    loop: true
                });

                // Animação dos pontos de "carregando..."
                anime({
                    targets: '.loading-dots span',
                    opacity: [0, 1],
                    duration: 800,
                    delay: anime.stagger(400),
                    loop: true,
                    direction: 'alternate',
                    easing: 'easeInOutQuad'
                });
            }

            // Simulação de progresso
            const progressInterval = setInterval(() => {
                progress += Math.random() * 5;
                if (progress > 100) progress = 100;

                if (progress === 100) {
                    clearInterval(progressInterval);
                    // Esconder o loader quando o carregamento estiver completo
                    setTimeout(() => {
                        document.getElementById('loader').style.display = 'none';
                    }, 500);
                }
            }, 300);
        }

        // Inicializar a esfera 3D
        function init3DSphere() {
            // Verificar se THREE está disponível
            if (typeof THREE === 'undefined') {
                console.error('Three.js não está carregado.');
                return;
            }

            // Verificar se o container existe
            const container = document.getElementById('sphere-3d-container');
            if (!container) {
                console.error('Container da esfera 3D não encontrado.');
                return;
            }

            // Configurar cena, câmera e renderizador
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(200, 200);

            // Garantir que o canvas seja interativo
            const canvas = renderer.domElement;
            canvas.style.pointerEvents = 'auto';

            container.appendChild(canvas);

            // Adicionar luzes
            const ambientLight = new THREE.AmbientLight(0x888888);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0x8B5CF6, 1);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);

            // Criar esfera com material especial
            const geometry = new THREE.SphereGeometry(2, 32, 32);
            const material = new THREE.MeshPhongMaterial({
                color: 0x7C3AED,
                shininess: 100,
                specular: 0x8B5CF6,
                emissive: 0x4A1DCD,
                emissiveIntensity: 0.2
            });

            sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);

            // Adicionar wireframe para efeito tecnológico
            const wireframe = new THREE.WireframeGeometry(geometry);
            const line = new THREE.LineSegments(wireframe);
            line.material.color.setHex(0x8B5CF6);
            line.material.opacity = 0.3;
            line.material.transparent = true;
            sphere.add(line);

            // Posicionar a câmera
            camera.position.z = 5;

            // Adicionar eventos de interação
            setupInteraction();

            // Iniciar animação
            animate();
        }

        // Configurar interação com a esfera
        function setupInteraction() {
            const container = document.getElementById('sphere-3d-container');
            if (!container) return;

            const canvas = container.querySelector('canvas');
            if (!canvas) return;

            // Adicionar eventos diretamente ao canvas
            canvas.addEventListener('mousedown', onMouseDown);
            document.addEventListener('mouseup', onMouseUp);
            document.addEventListener('mousemove', onMouseMove);
            canvas.addEventListener('touchstart', onTouchStart, { passive: false });
            document.addEventListener('touchend', onTouchEnd);
            document.addEventListener('touchmove', onTouchMove, { passive: false });
        }

        function onMouseDown(event) {
            isDragging = true;
            previousMousePosition = {
                x: event.clientX,
                y: event.clientY
            };
            event.stopPropagation(); // Impede que o evento se propague para outras camadas
        }

        function onMouseUp() {
            isDragging = false;
        }

        function onMouseMove(event) {
            if (!isDragging) return;

            const deltaMove = {
                x: event.clientX - previousMousePosition.x,
                y: event.clientY - previousMousePosition.y
            };

            sphereRotation.x += deltaMove.y * 0.01;
            sphereRotation.y += deltaMove.x * 0.01;

            previousMousePosition = {
                x: event.clientX,
                y: event.clientY
            };
        }

        function onTouchStart(event) {
            if (event.touches.length === 1) {
                event.preventDefault();
                isDragging = true;
                previousMousePosition = {
                    x: event.touches[0].clientX,
                    y: event.touches[0].clientY
                };
                event.stopPropagation(); // Impede que o evento se propague para outras camadas
            }
        }

        function onTouchEnd() {
            isDragging = false;
        }

        function onTouchMove(event) {
            if (!isDragging || event.touches.length !== 1) return;

            event.preventDefault();

            const deltaMove = {
                x: event.touches[0].clientX - previousMousePosition.x,
                y: event.touches[0].clientY - previousMousePosition.y
            };

            sphereRotation.x += deltaMove.y * 0.01;
            sphereRotation.y += deltaMove.x * 0.01;

            previousMousePosition = {
                x: event.touches[0].clientX,
                y: event.touches[0].clientY
            };
        }

        // Animação da esfera 3D
        function animate() {
            if (!renderer) return;

            requestAnimationFrame(animate);

            // Aplicar rotação suave mesmo quando não está sendo arrastada
            if (!isDragging) {
                sphereRotation.y += 0.005;
            }

            // Limitar rotação no eixo X para não virar de cabeça para baixo
            sphereRotation.x = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, sphereRotation.x));

            if (sphere) {
                sphere.rotation.x = sphereRotation.x;
                sphere.rotation.y = sphereRotation.y;
            }

            renderer.render(scene, camera);
        }

        // Inicializar o loader quando a página estiver carregada
        document.addEventListener('DOMContentLoaded', function () {
            initLoader();
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.js"></script>
    <script src="/js/chat.js" type="module"></script>
    <link rel="stylesheet" href="/components/loader/loader.css">
</body>

</html>